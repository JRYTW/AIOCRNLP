# 智能文件前置處理平台 (IDP) - Intelligent Document Processing

這是一個使用 PHP 和 Google Gemini API 建構的智能文件前置處理平台雛型，具備 AI-OCR 和 NLP 功能。

👉 [**智能文件前置處理平台 (IDP)**](https://ai.oo.gd) 👈

## 功能特色

### 🔍 多格式攝取
- 支援 PDF、JPG、JPEG、PNG、GIF、BMP、TIFF 等多種格式
- 處理歪斜、陰影、模糊的文件

### 🧠 語意理解 (NLP)
- 智能識別欄位意義
- 自動分辨營業收入、統一編號、公司名稱等關鍵欄位
- 識別財務報表結構

### ✅ 自動糾錯
- 會計恆等式檢核（資產 = 負債 + 權益）
- 毛利計算檢核（毛利 = 營收 - 成本）
- 統一編號格式驗證
- 自動標示邏輯錯誤與可疑數據

## 系統需求

- PHP 7.4 或以上版本
- PHP cURL 擴展
- PHP JSON 擴展
- Google Gemini API Key

## 安裝步驟

### 1. 取得 Gemini API Key

1. 前往 [Google AI Studio](https://makersuite.google.com/app/apikey)
2. 登入您的 Google 帳戶
3. 點擊「Create API Key」建立新的 API Key
4. 複製產生的 API Key

### 2. 設定專案

1. 將專案檔案放置於您的 Web 伺服器目錄（如 XAMPP 的 htdocs）

2. 編輯 `config.php`，將 `YOUR_GEMINI_API_KEY_HERE` 替換為您的 API Key：
   ```php
   define('GEMINI_API_KEY', '您的API金鑰');
   ```

3. 確保 `uploads` 目錄具有寫入權限

### 3. 啟動服務

**方法一：使用 PHP 內建伺服器（開發用）**
```bash
cd c:\Users\Jerry\Desktop\IDP
php -S localhost:8080
```
然後在瀏覽器開啟 http://localhost:8080

**方法二：使用 XAMPP/WAMP**
1. 將專案資料夾放入 htdocs
2. 啟動 Apache
3. 在瀏覽器開啟 http://localhost/IDP

## 專案結構

```
IDP/
├── index.html          # 前端介面
├── api.php             # API 處理端點
├── config.php          # 配置檔案
├── README.md           # 說明文件
├── classes/
│   ├── GeminiClient.php      # Gemini API 客戶端
│   └── DocumentProcessor.php # 文件處理器
└── uploads/            # 上傳檔案目錄
```

## 使用方式

1. 開啟網頁介面
2. 拖放或選擇要分析的文件（財務報表、發票等）
3. 點擊「開始分析」
4. 系統將自動：
   - 進行 OCR 文字辨識
   - 執行 NLP 語意分析
   - 進行邏輯檢核
5. 查看分析結果，包含：
   - 識別出的公司資訊
   - 財務數據
   - 驗證錯誤和警告
6. 可下載 JSON 格式的分析報告

## 技術架構

```
┌─────────────────────────────────────────────────────────┐
│                    外部客戶                              │
│                  (上傳文件)                              │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│              IDP 中介層 (Middleware)                     │
│  ┌─────────────────────────────────────────────────┐   │
│  │           文件上傳處理 (api.php)                 │   │
│  └─────────────────────────────────────────────────┘   │
│                        │                                │
│                        ▼                                │
│  ┌─────────────────────────────────────────────────┐   │
│  │      DocumentProcessor (文件處理器)             │   │
│  │  ┌─────────────┐ ┌─────────────┐ ┌───────────┐ │   │
│  │  │   AI-OCR    │ │    NLP     │ │  驗證器   │ │   │
│  │  │  文字辨識   │ │  語意分析  │ │ 邏輯檢核  │ │   │
│  │  └─────────────┘ └─────────────┘ └───────────┘ │   │
│  └─────────────────────────────────────────────────┘   │
│                        │                                │
│                        ▼                                │
│  ┌─────────────────────────────────────────────────┐   │
│  │          GeminiClient (API 客戶端)              │   │
│  └─────────────────────────────────────────────────┘   │
└─────────────────┬───────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│              Google Gemini API                          │
│            (AI 模型處理)                                 │
└─────────────────────────────────────────────────────────┘
                  │
                  ▼
┌─────────────────────────────────────────────────────────┐
│              銀行核心系統                                │
│            (接收結構化數據)                              │
└─────────────────────────────────────────────────────────┘
```

## 驗證規則

### 會計恆等式
- **資產 = 負債 + 權益**
- 容差：1%

### 毛利計算
- **毛利 = 營業收入 - 營業成本**
- 容差：1%

### 統一編號驗證
- 長度：8 位數字
- 包含檢核碼驗證

## API 回應格式

```json
{
  "success": true,
  "data": {
    "ocr": {
      "raw_text": "識別出的原始文字",
      "confidence": 95.5
    },
    "nlp": {
      "document_type": "財務報表",
      "company_info": {
        "name": "範例公司",
        "tax_id": "12345678"
      },
      "financial_data": {
        "revenue": "10,000,000",
        "total_assets": "50,000,000"
      }
    },
    "validation": {
      "status": "passed",
      "errors": [],
      "warnings": []
    }
  },
  "meta": {
    "processing_time": "5.2 秒",
    "timestamp": "2024-01-15 10:30:00"
  }
}
```

## 注意事項

1. **API 配額**：Gemini API 有使用限制，請注意配額
2. **文件大小**：預設最大 10MB，可在 config.php 調整
3. **安全性**：生產環境請加強安全措施
4. **隱私**：處理敏感財務文件時請確保合規

## 擴展建議

1. 增加資料庫儲存分析結果
2. 實作使用者認證系統
3. 增加批次處理功能
4. 整合更多驗證規則
5. 支援更多文件類型

## 授權

此專案僅供學習和示範用途。
